@page "/"
@using System.Threading
@using MagazynierApp.Shared
@inject NavigationManager uriHelper;
@inject IJSRuntime JSRuntime
@inject User User
<div class="toast align-items-center text-white bg-primary border-0" role="alert" aria-live="assertive" aria-atomic="true">
  <div class="d-flex">
    <div class="toast-body">
      Hello, world! This is a toast message.
    </div>
    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
  </div>
</div>
<h2>Opcjonalnie: Lista maszyn mało szczegółowa</h2>
<h2>Opcjonalnie: Alerty z ostatniego przedziału czasu np dzień</h2>


@code {
    protected override void OnInitialized()
    {
        _ = RequestNotificationSubscriptionAsync();
    }
    
    async Task RequestNotificationSubscriptionAsync()
    {
        var subscription = await JSRuntime.InvokeAsync<NotificationSubscription>("blazorPushNotifications.requestSubscription");
        if (subscription != null)
        {
            try
            {
                await User.SubscribeToNotifications(subscription);
            }
            catch (Exception ex)
            {
                Console.WriteLine(ex);
            }
        }
    }
}

